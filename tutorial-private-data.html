<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Hyperledger Fabric SDK for node.js Tutorial: How to use private data</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Hyperledger Fabric SDK for node.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-api.html">api</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AffiliationService.html">AffiliationService</a></li><li><a href="BaseClient.html">BaseClient</a></li><li><a href="BasePackager.html">BasePackager</a></li><li><a href="BasicCommitHandler.html">BasicCommitHandler</a></li><li><a href="BlockDecoder.html">BlockDecoder</a></li><li><a href="CertificateAuthority.html">CertificateAuthority</a></li><li><a href="ChaincodeRegistration.html">ChaincodeRegistration</a></li><li><a href="Channel.html">Channel</a></li><li><a href="ChannelEventHub.html">ChannelEventHub</a></li><li><a href="ChannelPeer.html">ChannelPeer</a></li><li><a href="Client.html">Client</a></li><li><a href="CouchDBKeyValueStore.html">CouchDBKeyValueStore</a></li><li><a href="CryptoKeyStore.html">CryptoKeyStore</a></li><li><a href="CryptoSuite_ECDSA_AES.html">CryptoSuite_ECDSA_AES</a></li><li><a href="CryptoSuite_PKCS11.html">CryptoSuite_PKCS11</a></li><li><a href="DiscoveryEndorsementHandler.html">DiscoveryEndorsementHandler</a></li><li><a href="ECDSA_KEY.html">ECDSA_KEY</a></li><li><a href="EndorsementPolicy.html">EndorsementPolicy</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="FileKeyValueStore.html">FileKeyValueStore</a></li><li><a href="global.html#Identity">Identity</a></li><li><a href="IdentityService.html">IdentityService</a></li><li><a href="module.exports_module.exports.html">module.exports#module.exports</a></li><li><a href="module-api.CommitHandler.html">api.CommitHandler</a></li><li><a href="module-api.CryptoSuite.html">api.CryptoSuite</a></li><li><a href="module-api.EndorsementHandler.html">api.EndorsementHandler</a></li><li><a href="module-api.Hash.html">api.Hash</a></li><li><a href="module-api.Key.html">api.Key</a></li><li><a href="module-api.KeyValueStore.html">api.KeyValueStore</a></li><li><a href="MSP.html">MSP</a></li><li><a href="MSPManager.html">MSPManager</a></li><li><a href="NetworkConfig_1_0.html">NetworkConfig_1_0</a></li><li><a href="Orderer.html">Orderer</a></li><li><a href="Organization.html">Organization</a></li><li><a href="Peer.html">Peer</a></li><li><a href="PKCS11_ECDSA_KEY.html">PKCS11_ECDSA_KEY</a></li><li><a href="Remote.html">Remote</a></li><li><a href="Signer.html">Signer</a></li><li><a href="SigningIdentity.html">SigningIdentity</a></li><li><a href="TransactionID.html">TransactionID</a></li><li><a href="User.html">User</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-app-dev-env-setup.html">Setting up the Application Developer's Environment</a></li><li><a href="tutorial-channel-create.html">How to create a Hyperledger Fabric channel</a></li><li><a href="tutorial-channel-events.html">How to use the channel-based event service</a></li><li><a href="tutorial-discovery.html">How to use the service discovery</a></li><li><a href="tutorial-logging.html">How to use logging</a></li><li><a href="tutorial-metadata-chaincode.html">How to add CouchDB indexes during chaincode installation</a></li><li><a href="tutorial-mutual-tls.html">How to configure mutual TLS</a></li><li><a href="tutorial-network-config.html">How to use a common connection profile</a></li><li><a href="tutorial-private-data.html">How to use private data</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#CLIENT">CLIENT</a></li><li><a href="global.html#HFAFFILIATIONMGR">HFAFFILIATIONMGR</a></li><li><a href="global.html#HFGENCRL">HFGENCRL</a></li><li><a href="global.html#HFINTERMEDIATECA">HFINTERMEDIATECA</a></li><li><a href="global.html#HFREGISTRARATTRIBUTES">HFREGISTRARATTRIBUTES</a></li><li><a href="global.html#HFREGISTRARDELEGATEROLES">HFREGISTRARDELEGATEROLES</a></li><li><a href="global.html#HFREGISTRARROLES">HFREGISTRARROLES</a></li><li><a href="global.html#HFREVOKER">HFREVOKER</a></li><li><a href="global.html#loadConfigGroup">loadConfigGroup</a></li><li><a href="global.html#loadConfigValue">loadConfigValue</a></li><li><a href="global.html#ORDERER">ORDERER</a></li><li><a href="global.html#package">package</a></li><li><a href="global.html#PEER">PEER</a></li><li><a href="global.html#toEnvelope">toEnvelope</a></li><li><a href="global.html#USER">USER</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>How to use private data</h2>
</header>

<article>
    <p>This tutorial illustrates how to use the Node.js SDK APIs to store and retrieve private data in the Hyperledger Fabric network.</p>
<p>Starting in v1.2, Fabric offers the ability to create private data collections, which allows a subset of organizations on
a channel to endorse, commit, or query private data without having to create a separate channel.For more information,
refer to <a href="http://hyperledger-fabric.readthedocs.io/en/latest/private-data/private-data.html">Private Data Concept</a>, <a href="http://hyperledger-fabric.readthedocs.io/en/latest/private-data-arch.html">Private Data Architecture</a>, and <a href="http://hyperledger-fabric.readthedocs.io/en/latest/private_data_tutorial.html">Using Private Data in Fabric</a>.</p>
<h3>Overview</h3><p>The following are the steps to use private data with the Node.js SDK. Check out below sections for the details of these steps.</p>
<ol>
<li>Create a collection definition json file</li>
<li>Implement chaincode to store and query private data</li>
<li>Install and instantiate chaincode with a collection definition</li>
<li>Invoke chaincode to store and query private data</li>
<li>Purge private data</li>
</ol>
<h3>Create a collection definition json file</h3><p>A collection definition describes who can persist data, how many peers the data is distributed to, how many peers are
required to disseminate the private data, and how long the private data is persisted in the private database. Chaincode APIs
will map the collection to the private data by the collection name.</p>
<p>A collection definition is composed of the following five properties.</p>
<ul>
<li><code>name</code>: Name of the collection.</li>
<li><code>policy</code>: Defines the organization peers allowed to persist the collection data.</li>
<li><code>requiredPeerCount</code>: Number of peers required to disseminate the private data as a condition
of the endorsement of the chaincode</li>
<li><code>maxPeerCount</code>: For data redundancy purposes, the number of other peers that the current
endorsing peer will attempt to distribute the data to. If an endorsing peer goes down, these
other peers are available at commit time if there are requests to pull the private data.</li>
<li><code>blockToLive</code>: For very sensitive information such as pricing or personal information,
this value represents how long the data should live on the private database in terms of blocks.
The data will be purged after this specified number of blocks on the private database. To keep
private data indefinitely, that is, to never purge private data, set the blockToLive property to 0.</li>
</ul>
<p>Here is a sample collection definition JSON file, containing an array of two collection definitions:</p>
<pre class="prettyprint source"><code>[{
    &quot;name&quot;: &quot;collectionMarbles&quot;,
    &quot;policy&quot;: {
      &quot;identities&quot;: [{
          &quot;role&quot;: {
            &quot;name&quot;: &quot;member&quot;,
            &quot;mspId&quot;: &quot;Org1MSP&quot;
          }
        },
        {
          &quot;role&quot;: {
            &quot;name&quot;: &quot;member&quot;,
            &quot;mspId&quot;: &quot;Org2MSP&quot;
          }
        }
      ],
      &quot;policy&quot;: {
        &quot;1-of&quot;: [
          {
            &quot;signed-by&quot;: 0
          },
          {
            &quot;signed-by&quot;: 1
          }
        ]
      }
    },
    &quot;requiredPeerCount&quot;: 1,
    &quot;maxPeerCount&quot;: 2,
    &quot;blockToLive&quot;: 100
  },
  {
    &quot;name&quot;: &quot;collectionMarblePrivateDetails&quot;,
    &quot;policy&quot;: {
      &quot;identities&quot;: [{
        &quot;role&quot;: {
          &quot;name&quot;: &quot;member&quot;,
          &quot;mspId&quot;: &quot;Org1MSP&quot;
        }
      }],
      &quot;policy&quot;: {
        &quot;1-of&quot;: [{
          &quot;signed-by&quot;: 0
        }]
      }
    },
    &quot;requiredPeerCount&quot;: 1,
    &quot;maxPeerCount&quot;: 1,
    &quot;blockToLive&quot;: 100
  }
]</code></pre><p>This example contains two private data collections: <code>collectionMarbles</code> and <code>collectionMarblePrivateDetails</code>.
The policy property in the collectionMarbles definition allows all members of the channel (<code>Org1</code> and <code>Org2</code>) to have
the private data in a private database. The collectionMarblesPrivateDetails collection allows only members of <code>Org1</code>
to have the private data in their private database.</p>
<p>For Node.js SDK, you must define policies in the same format as shown in the above.</p>
<h3>Implement chaincode to store and query private data</h3><p>Fabric provides chaincode APIs to store and query private data. As an example, check out <a href="https://github.com/hyperledger/fabric-samples/blob/master/chaincode/marbles02_private/go/marbles_chaincode_private.go">marbles private data example</a>
to understand how to use the chaincode APIs to read and write private data.</p>
<p>This example implements the following functions to manage private data.</p>
<ul>
<li><code>readMarble</code>: query the values of the <code>name</code>, <code>color</code>, <code>size</code> and <code>owner</code> attributes using collection <code>collectionMarbles</code>.</li>
<li><code>readMarblePrivateDetails</code>: query the values of the <code>price</code> attribute using collection <code>collectionMarblePrivateDetails</code>.</li>
<li><code>initMarble</code>: store private data for the collections.</li>
<li><code>delete</code>: delete a marble from private database.</li>
</ul>
<h3>Install and instantiate chaincode with a collection definition</h3><p>Client applications interact with the blockchain ledger through chaincode. As such
we need to install and instantiate the chaincode on every peer that will execute and
endorse transactions.</p>
<ul>
<li>Install chaincode. No specific parameter needed to support private data.</li>
<li>Instantiate chaincode. To support private data, the request must include the <code>collections-config</code> attribute.<pre class="prettyprint source"><code>      const collectionsConfigPath = path.resolve(__dirname, collection_definition_json_filepath);
      var request = {
          targets: peers,
          chaincodeId: chaincodeId,
          chaincodeType: chaincodeType,
          chaincodeVersion: chaincodeVersion,
          fcn: functionName,
          args: args,
          txId: tx_id,
          'collections-config': collectionsConfigPath
      };
      var endorsementResults = await channel.sendInstantiateProposal(request, time_out);
      // additional code needed to validate endorsementResults and send transaction to commit
      ......</code></pre></li>
</ul>
<h3>Invoke chaincode to store and query private data</h3><p>You must be authorized to transact with the private data based on the policy defined in collection definition.
Recall that the above collection definition allows all members of <code>Org1</code> and <code>Org2</code> to access <code>collectionMarbles</code> (name,
color, size, and owner) in their private database, but only peers in <code>Org1</code> can have access to
<code>collectionMarblePrivateDetails</code> (price) in their private database.</p>
<p>Acting as a member of <code>Org1</code>, you can do the following with <a href="https://github.com/hyperledger/fabric-samples/blob/master/chaincode/marbles02_private/go/marbles_chaincode_private.go">marbles private data example</a>,</p>
<ul>
<li>Invoke <code>initMarble</code> to create a marble with private data.</li>
<li>Invoke <code>readMarble</code> to read name, color, size and owner from the private database for <code>collectionMarbles</code>.</li>
<li>Invoke <code>readMarblePrivateDetails</code> to read price from the private database for <code>collectionMarblePrivateDetails</code>.</li>
</ul>
<h3>Purge private data</h3><p>The Hyperledger Fabric allows client applications to optionally purge the private data in a collection by setting the
<code>blockToLive</code> property. This option may be needed when private data include personal or confidential information
and transacting parties want to have a limited lifespan for these data.</p>
<p>When <code>blockToLive</code> is set to a non-zero value in the collection definition file, Fabric will automatically purge the related
private data after the specified number of blocks are committed. Client applications do not need to call any API.</p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on 2018-09-10T17:14:33+00:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>