<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Hyperledger Fabric SDK for node.js Tutorial: fabric-client: How to install and start your chaincode</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.cosmo.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Hyperledger Fabric SDK for node.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-fabric-network.html">fabric-network</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="AffiliationService.html">AffiliationService</a></li><li><a href="BaseCheckpointer.html">BaseCheckpointer</a></li><li><a href="BaseClient.html">BaseClient</a></li><li><a href="BasePackager.html">BasePackager</a></li><li><a href="BaseWallet.html">BaseWallet</a></li><li><a href="BasicCommitHandler.html">BasicCommitHandler</a></li><li><a href="BasicProverHandler.html">BasicProverHandler</a></li><li><a href="BlockDecoder.html">BlockDecoder</a></li><li><a href="CertificateAuthority.html">CertificateAuthority</a></li><li><a href="Chaincode.html">Chaincode</a></li><li><a href="ChaincodeRegistration.html">ChaincodeRegistration</a></li><li><a href="Channel.html">Channel</a></li><li><a href="ChannelEventHub.html">ChannelEventHub</a></li><li><a href="ChannelPeer.html">ChannelPeer</a></li><li><a href="Client.html">Client</a></li><li><a href="CommitHandler.html">CommitHandler</a></li><li><a href="CouchDBKeyValueStore.html">CouchDBKeyValueStore</a></li><li><a href="CryptoKeyStore.html">CryptoKeyStore</a></li><li><a href="CryptoSuite_ECDSA_AES.html">CryptoSuite_ECDSA_AES</a></li><li><a href="CryptoSuite_PKCS11.html">CryptoSuite_PKCS11</a></li><li><a href="DiscoveryEndorsementHandler.html">DiscoveryEndorsementHandler</a></li><li><a href="ECDSA_KEY.html">ECDSA_KEY</a></li><li><a href="EndorsementHandler.html">EndorsementHandler</a></li><li><a href="EndorsementPolicy.html">EndorsementPolicy</a></li><li><a href="Endpoint.html">Endpoint</a></li><li><a href="FabricCAClient.html">FabricCAClient</a></li><li><a href="FabricCAServices.html">FabricCAServices</a></li><li><a href="FileKeyValueStore.html">FileKeyValueStore</a></li><li><a href="IdentityService.html">IdentityService</a></li><li><a href="InMemoryKVS.html">InMemoryKVS</a></li><li><a href="module.exports_module.exports.html">module.exports#module.exports</a></li><li><a href="module-fabric-network.AbstractEventHubSelectionStrategy.html">fabric-network.AbstractEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.Contract.html">fabric-network.Contract</a></li><li><a href="module-fabric-network.CouchDBWallet.html">fabric-network.CouchDBWallet</a></li><li><a href="module-fabric-network.FileSystemWallet.html">fabric-network.FileSystemWallet</a></li><li><a href="module-fabric-network.Gateway.html">fabric-network.Gateway</a></li><li><a href="module-fabric-network.HSMWalletMixin.html">fabric-network.HSMWalletMixin</a></li><li><a href="module-fabric-network.InMemoryWallet.html">fabric-network.InMemoryWallet</a></li><li><a href="module-fabric-network.Network.html">fabric-network.Network</a></li><li><a href="module-fabric-network.Query.html">fabric-network.Query</a></li><li><a href="module-fabric-network.RoundRobinEventHubSelectionStrategy.html">fabric-network.RoundRobinEventHubSelectionStrategy</a></li><li><a href="module-fabric-network.TimeoutError.html">fabric-network.TimeoutError</a></li><li><a href="module-fabric-network.Transaction.html">fabric-network.Transaction</a></li><li><a href="module-fabric-network.X509WalletMixin.html">fabric-network.X509WalletMixin</a></li><li><a href="MSP.html">MSP</a></li><li><a href="MSPManager.html">MSPManager</a></li><li><a href="NetworkConfig_1_0.html">NetworkConfig_1_0</a></li><li><a href="Orderer.html">Orderer</a></li><li><a href="Organization.html">Organization</a></li><li><a href="Package.html">Package</a></li><li><a href="Peer.html">Peer</a></li><li><a href="PKCS11_ECDSA_KEY.html">PKCS11_ECDSA_KEY</a></li><li><a href="ProverHandler.html">ProverHandler</a></li><li><a href="Remote.html">Remote</a></li><li><a href="TokenClient.html">TokenClient</a></li><li><a href="TransactionID.html">TransactionID</a></li><li><a href="User.html">User</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="interfaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Interfaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-fabric-network.EventHubDisconnectError.html">fabric-network.EventHubDisconnectError</a></li><li><a href="module-fabric-network.FabricError.html">fabric-network.FabricError</a></li><li><a href="module-fabric-network.Wallet.html">fabric-network.Wallet</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-app-dev-env-setup.html">Setting up the Application Developer's Environment</a></li><li><a href="tutorial-chaincode-lifecycle.html">fabric-client: How to install and start your chaincode</a></li><li><a href="tutorial-channel-create.html">fabric-client: How to create a Hyperledger Fabric channel</a></li><li><a href="tutorial-channel-events.html">fabric-client: How to use the channel-based event service</a></li><li><a href="tutorial-discovery.html">fabric-client: How to use the discovery service</a></li><li><a href="tutorial-event-checkpointer.html">fabric-network: How to replay missed events</a></li><li><a href="tutorial-event-hub-management.html">fabric-network: How to automatically select and reconnect to event hubs</a></li><li><a href="tutorial-fabtoken.html">fabric-client: How to perform token operations</a></li><li><a href="tutorial-grpc-settings.html">fabric-client: How to set gRPC settings</a></li><li><a href="tutorial-handlers.html">fabric-client: How to use the endorsement and commit handlers</a></li><li><a href="tutorial-listening-to-events.html">fabric-network: How to listen to events</a></li><li><a href="tutorial-logging.html">fabric-client: How to use logging</a></li><li><a href="tutorial-metadata-chaincode.html">fabric-client: How to add CouchDB indexes during chaincode installation</a></li><li><a href="tutorial-mutual-tls.html">fabric-client: How to configure mutual TLS</a></li><li><a href="tutorial-network-config.html">fabric-client: How to use a common connection profile</a></li><li><a href="tutorial-private-data.html">How to use private data</a></li><li><a href="tutorial-query-peers.html">fabric-network: How to select peers for evaluating transactions (queries)</a></li><li><a href="tutorial-sign-transaction-offline.html">Working with an offline private key</a></li><li><a href="tutorial-transaction-commit-events.html">fabric-network: How to wait for transactions to be committed to the ledger</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="global.html#CLIENT">CLIENT</a></li><li><a href="global.html#HFAFFILIATIONMGR">HFAFFILIATIONMGR</a></li><li><a href="global.html#HFGENCRL">HFGENCRL</a></li><li><a href="global.html#HFINTERMEDIATECA">HFINTERMEDIATECA</a></li><li><a href="global.html#HFREGISTRARATTRIBUTES">HFREGISTRARATTRIBUTES</a></li><li><a href="global.html#HFREGISTRARDELEGATEROLES">HFREGISTRARDELEGATEROLES</a></li><li><a href="global.html#HFREGISTRARROLES">HFREGISTRARROLES</a></li><li><a href="global.html#HFREVOKER">HFREVOKER</a></li><li><a href="global.html#loadConfigGroup">loadConfigGroup</a></li><li><a href="global.html#loadConfigValue">loadConfigValue</a></li><li><a href="global.html#ORDERER">ORDERER</a></li><li><a href="global.html#package">package</a></li><li><a href="global.html#PEER">PEER</a></li><li><a href="global.html#toEnvelope">toEnvelope</a></li><li><a href="global.html#toHex">toHex</a></li><li><a href="global.html#toSignedCommand">toSignedCommand</a></li><li><a href="global.html#USER">USER</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>fabric-client: How to install and start your chaincode</h2>
</header>

<article>
    <p>This tutorial illustrates how to handle the lifecycle of your chaincode. The installation, updating, and the starting of chaincode has had been changed with Hyperledger Fabric 2.0 and fabric-client 2.0.</p>
<p>For more information on:</p>
<ul>
<li>getting started with Hyperledger Fabric see
<a href="http://hyperledger-fabric.readthedocs.io/en/latest/build_network.html">Building your first network</a>.</li>
<li>the configuration of a channel in Hyperledger Fabric and the internal
process of creating and updating see
<a href="http://hyperledger-fabric.readthedocs.io/en/latest/configtx.html">Hyperledger Fabric channel configuration</a></li>
<li><a href="https://hyperledger-fabric.readthedocs.io/en/latest/discovery-overview.html">Chaincode Lifecycle</a></li>
</ul>
<p>The following assumes an understanding of the Hyperledger Fabric network
(orderers and peers),
and of Node application development, including the use of the
Javascript <code>promise</code> and <code>async await</code>.</p>
<h3>Overview</h3><p>This discussion will focus on the steps that are required by an application
program that will be managing the install, updating and starting of chaincodes
on your Hyperledger Fabric network. The existing api's for managing the lifecycle
of your pre 2.0 chaincodes will still be available in fabric-client, however it
will not be discussed here.</p>
<p>The steps to manage chaincode:</p>
<ul>
<li><code>setup</code> - create the necessary application objects</li>
<li><code>package</code> - package the chaincode source artifacts</li>
<li><code>install</code> - push to the network</li>
<li><code>define for organization</code> - each organization will define a specific chaincode definition</li>
<li><code>define for the channel</code> - the channel members will agree to run a specific chaincode definition</li>
<li><code>initialize</code> - start the chaincode container and initialize the chaincode</li>
</ul>
<h4>New Class</h4><p>A new class <a href="Chaincode.html">Chaincode</a> has been added to the fabric-client to encapsulate
a chaincode definition.
A <a href="Chaincode.html">Chaincode</a> instance will be created by a client instance's
<a href="Client.html#newChaincode">newChaincode()</a> method.
Then using the new instance, you will be able to build up a chaincode definition
with the following methods.</p>
<ul>
<li><a href="Chaincode.html#setEndorsementPolicy">setEndorsementPolicy</a> - Provide the endorsement policy for this chaincode.</li>
<li><a href="Chaincode.html#setCollectionConfig">setCollectionConfig</a> - Provide the collection configuration for this chaincode.</li>
<li><a href="Chaincode.html#setSequence">setSequence</a> - Provide the modification number for this chaincode.</li>
<li><a href="Chaincode.html#setPackage">setPackage</a> - Provide the package when not packaging this chaincode locally.</li>
<li><a href="Chaincode.html#setHash">setHash</a> - Provide the package hash when not doing an install locally of this chaincode.</li>
</ul>
<p>The chaincode instance will allow for the packaging and installing of chaincode
to a peer within your organization with the following methods.</p>
<ul>
<li><a href="Chaincode.html#package">package</a> Package the files at the locations provided.</li>
<li><a href="Chaincode.html#install">install</a> Install the package on the specified peers.</li>
</ul>
<p>Once the chaincode definition has all the necessary attributes, it may be used
by a channel instance to be defined both for an organization and channel wide.</p>
<h4>New methods on Channel</h4><p>The <a href="Channel.html">Channel</a> class has been enhanced to include new methods to define
a chaincode for an organization and for the channel wide use.</p>
<ul>
<li>defineChaincodeForOrg - Define
the chaincode for an organization.</li>
<li>defineChaincode - Define
the chaincode for a channel.</li>
</ul>
<h4>New method on Client</h4><p>The <a href="Client.html">Client</a> class has been enhanced to include new method to create
a <a href="Chaincode.html">Chaincode</a> instance.</p>
<ul>
<li><a href="Client.html#newChaincode">newChaincode</a> - Create a <a href="Chaincode.html">Chaincode</a> instance.</li>
</ul>
<h3>Step 1: Setup</h3><p>In this step we will be building
the application objects needed to perform the operational steps that follow.
An fabric-client operational environment is required before any of the
following steps may be performed. A client instance is needed
that has a user store, crypto suite, and a user assigned. The target peers,
orderer, and channel instance objects will also be required prior to doing
the any of the following steps.</p>
<p>The following sample code assumes that all of the normal fabric-client
setup has been completed and only shows the new chaincode lifecycle
related calls.</p>
<pre class="prettyprint source"><code>// get the chaincode instance associated with the client
const mychaincode = client.newChaincode('mychaincode', 'version1');

// The endorsement policy - required.
const policy_def = {
   identities: [
      {role: {name: 'member', mspId: 'org1'}},
      {role: {name: 'member', mspId: 'org2'}}
   ],
   policy: {
       '1-of': [{'signed-by': 0}, {'signed-by': 1}]
   }
};
mychaincode.setEndorsementPolicy(policy_def);

// The collection configuration - optional.
const config_def = [{
   name: 'detailCol',
   policy: {
      identities: [
         {role: {name: 'member', mspId: 'Org1MSP'}},
         {role: {name: 'member', mspId: 'Org2MSP'}}
      ],
      policy: {
         '1-of': [{'signed-by': 0}, {'signed-by': 1}]
      }
   },
   requiredPeerCount: 1,
   maxPeerCount: 1,
   blockToLive: 100
}];
mychaincode.setCollectionConfig(config_def));

// set the sequence (modification) number - required.
mychaincode.setSequence(1); //set to one for a new chaincode</code></pre><h3>Step 2: Package</h3><p>This step will only be required by a single organization. The organization will
take the source artifacts, chaincode source code and metadata files, and have
the fabric-client package them. This package may then be sent to other
organizations or administrators of your fabric network to be installed on
the network.</p>
<p>The following example is for the organization that packages the code
and then will send to other organizations to be installed.</p>
<pre class="prettyprint source"><code>// package the source code
const packge_request = {
   chaincodeType: 'golang',
   goPath: '/gopath',
   chaincodePath: '/path/to/code',
   metadataPath: '/path/to/metadat'
}
const package = await mychaincode.package(package_request);</code></pre><p>The following example is for the organization that has not done the
packaging, but will do the install.</p>
<pre class="prettyprint source"><code>// use an existing package
mychaincode.setPackage(package);</code></pre><h3>Step 3: Install</h3><p>This step will be required by all organizations that will be running the chaincode
(executing transactions). The install will take the packaged source code artifacts
and send it to a peer or peers in your organization. Installing chaincode requires
admin authority for the organization. The peer will return a hash value, a unique
identifer for this chaincode package. The hash value will be needed later when
the chaincode is defined. The chaincode object will also store the value for
the next step.</p>
<p>The following sample assumes that the chaincode object being used has
been setup and packaged or an error would be thrown.</p>
<pre class="prettyprint source"><code>// install chaincode package on peers
 const install_request = {
   targets: [peer1, peer2],
   request_timeout: 20000 // give the peers some extra time
 }
const hash = await mychaincode.install(install_request);

// hash value is stored
const same_hash = mychaincode.getHash();</code></pre><p>For organizations that will not be running the chaincode and are
still required to approve the chaincode the following example
shows how they would by pass the install and just assign the
hash value to the chaincode instance. The hash value must be
the value that was returned by the peer when the chaincode was installed.</p>
<pre class="prettyprint source"><code>// set hash value instead of doing an install
mychaincode.setHash(hash);</code></pre><h3>Step 4: Define for your organization</h3><p>This step wlll define a chaincode for your organization.
The defining action will be required by enough organizations
to satisfy the channel's chaincode lifecycle system policy.
By default this will be a majority of the
organizations on the channel. Each of these organizations will endorse and
commit a transaction that defines a chaincode and it's operational settings.
This may be thought of not only as a definition of the chaincode but a vote
to authorize the running of the chaincode with these settings.
These are separate organizational chaincode definitions
transactions submitted by each organizations and each committed to the
ledger. This definition is for a specific organization, specific settings,
and only on this channel.
The organizational chaincode definition transaction may be submitted at any
time, but must be submitted prior to being able to execute the chaincode
on a peer within the organization. This is how a new organization may start
running an existing chaincode other organization are currently running.
The transactions must include the exact same chaincode definition.
The definition does not include the package, it includes the hash value
that uniquely identifies the chaincode source artifacts.
An organization will be able to submit the organizational chaincode definition
transaction without having installed the package, but has received the hash
value from an organization that did install the package.</p>
<p>The following sample assumes that the chaincode object being used has
been setup and installed or an error will be thrown.</p>
<pre class="prettyprint source"><code>// send a define chaincode for organization transaction
const tx_id = client.newTransactionID();
const request = {
   target: peer1,
   chaincode: mychaincode,
   txId: tx_id
}
// send to the peer to be endorsed
const {proposalResponses, proposal} = await mychannel.defineChaincodeForOrg(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h3>Step 5: Define for the channel</h3><p>This step will define a chaincode for your channel. The defining action will
not change the chaincode or it's settings, but rather confirm the
organizational chaincode definition for the channel. 
The channel chaincode definition transaction will
be submitted by only one organization. 
A successful transaction must be endorsed by enough
organizations to satisfy the channel's chaincode lifecycle system policy
and there must be enough committed organizational chaincode definition
transactions committed that also satisfies the
channel's chaincode lifecycle system policy.
Think of this step as the tallying of the votes to run the chaincode.
The action to actually count the votes must be approved by enough members
and then there must be enough votes before the chaincode will
be allowed to run.
When only a chaincode setting has been changed, like an endorsement policy,
a successful commit of the channel chaincode definition transaction will
enable the new policy for this chaincode. The initialize step will not be
required as the chaincode container will not have to change. If this is
for a new chaincode or an update to the chaincode code, then the initialize
step will be required.</p>
<pre class="prettyprint source"><code>// send a define chaincode for channel transaction
const tx_id = client.newTransactionID();
const request = {
   targets: [peer1, peer3],
   chaincode: mychaincode,
   txId: tx_id
}
// send to the peers to be endorsed
const {proposalResponses, proposal} = await mychannel.defineChaincode(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h3>Step 6: Initialize</h3><p>This step will start new chaincode on your channel.
This will be the last step before the chaincode may be used for invokes and
queries.
This step will...
The initialize transaction will start the container and then call the
<code>init</code> method of the chaincode with the provided arguments.</p>
<pre class="prettyprint source"><code>// initialize the chaincode
const tx_id = client.newTransactionID();
const request = {
   chaincodeId : chaincodeId,
   fcn: 'init',
   args: args,
   txId: tx_id
}
// starting the container will take longer than the normal request-timeout
const init_results = await mychannel.sendTransaction(request, 20000);
const orderer_request = {
   proposalResponses: init_results[0],
   proposal: init_results[1]
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h3>Sample situations</h3><p>The following samples will show the important snippets needed to perform the
different situations.</p>
<h4>New chaincode</h4><p>When installing chaincode for the first time, all 6 steps must be run.
The following sample shows the code needed when the organization
will be packaging the chaincode, installing it, and being the organization
to define it for the entire channel and initialize it.</p>
<pre class="prettyprint source"><code>// step 1:
const mychaincode = client.newChaincode('mychaincode', 'version1');
const policy_def = { ... };
mychaincode.setEndorsementPolicy(policy_def);
mychaincode.setSequence(1); //set to one for a new chaincode

// step 2:
const packge_request = {
   chaincodeType: 'golang',
   goPath: '/gopath',
   chaincodePath: '/path/to/code',
   metadataPath: '/path/to/metadat'
}
const package = await mychaincode.package(package_request);

// step 3:
 const install_request = {
   targets: [peer1, peer2],
   request_timeout: 20000 // give the peers some extra time
 }
const hash = await mychaincode.install(install_request);

// step 4:
const tx_id = client.newTransactionID();
const request = {
   target: peer1,
   chaincode: mychaincode,
   txId: tx_id
}
const {proposalResponses, proposal} = await mychannel.defineChaincodeForOrg(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
const results = await mychannel.sendTransaction(orderer_request);

//step 5:
const tx_id = client.newTransactionID();
const request = {
   targets: [peer1, peer3],
   chaincode: mychaincode,
   txId: tx_id
}
const {proposalResponses, proposal} = await mychannel.defineChaincode(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
const results = await mychannel.sendTransaction(orderer_request);

// step 6:
const tx_id = client.newTransactionID();
const request = {
   chaincodeId : chaincodeId,
   fcn: 'init',
   args: args,
   txId: tx_id
}
const init_results = await mychannel.sendTransaction(request, 20000);
const orderer_request = {
   proposalResponses: init_results[0],
   proposal: init_results[1]
}
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h4>Update the chaincode code</h4><p>When updating the chaincode all 6 steps must be performed and care must be
taken in setting the sequence number to be sure it reflects the current
modification number of the chaincode definition. In this case no other
changes have been done to the chaincode definition since it was first
installed, so the sequence number is 2.</p>
<p>The following sample shows the code needed when the organization
will be packaging the chaincode, installing it, and being the organization
to define it for the entire channel and initialize it.</p>
<pre class="prettyprint source"><code>// step 1:
const mychaincode = client.newChaincode('mychaincode', 'version2');
const policy_def = { ... };
mychaincode.setEndorsementPolicy(policy_def);
mychaincode.setSequence(2);

// step 2:
// package the source code
const packge_request = {
   chaincodeType: 'golang',
   goPath: '/gopath',
   chaincodePath: '/path/to/code',
   metadataPath: '/path/to/metadat'
}
const package = await mychaincode.package(package_request);

// step 3:
 const install_request = {
   targets: [peer1, peer2],
   request_timeout: 20000 // give the peers some extra time
 }
const hash = await mychaincode.install(install_request);

// step 4:
const tx_id = client.newTransactionID();
const request = {
   target: peer1,
   chaincode: mychaincode,
   txId: tx_id
}
const {proposalResponses, proposal} = await mychannel.defineChaincodeForOrg(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
const results = await mychannel.sendTransaction(orderer_request);

//step 5:
const tx_id = client.newTransactionID();
const request = {
   targets: [peer1, peer3],
   chaincode: mychaincode,
   txId: tx_id
}
// send to the peers to be endorsed
const {proposalResponses, proposal} = await mychannel.defineChaincode(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);

// step 6:
// initialize the chaincode
const tx_id = client.newTransactionID();
const request = {
   chaincodeId : chaincodeId,
   fcn: 'init',
   args: args,
   txId: tx_id
}
// starting the container will take longer than the normal request-timeout
const init_results = await mychannel.sendTransaction(request, 20000);
const orderer_request = {
   proposalResponses: init_results[0],
   proposal: init_results[1]
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h4>Modify the Endorsement policy</h4><p>When updating the endorsement policy only 4 steps must be performed and care must be
taken in setting the sequence number to be sure it reflects the current
modification number of the chaincode definition. In this case let us assume
that the chaincode has been updated once, so the sequence number is 3.
step 2 maybe skipped as there will not be a new package. It might
seem that we can also skip step 3, but we still need the hash value
to uniquely identify the chaincode source that was installed earlier and has
not been changed.</p>
<p>The following sample shows the code needed when the organization
is redefining it and the organization
to define it for the entire channel.</p>
<pre class="prettyprint source"><code>// step 1:
const mychaincode = client.newChaincode('mychaincode', 'version2');
const new_policy_def = { ... };
mychaincode.setEndorsementPolicy(new_policy_def);
mychaincode.setSequence(3);

// step 3:
mychaincode.setHash(hash);

// step 4:
const tx_id = client.newTransactionID();
const request = {
   target: peer1,
   chaincode: mychaincode,
   txId: tx_id
}
const {proposalResponses, proposal} = await mychannel.defineChaincodeForOrg(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
const results = await mychannel.sendTransaction(orderer_request);

//step 5:
const tx_id = client.newTransactionID();
const request = {
   targets: [peer1, peer3],
   chaincode: mychaincode,
   txId: tx_id
}
// send to the peers to be endorsed
const {proposalResponses, proposal} = await mychannel.defineChaincode(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
// send to the orderer to be committed
const results = await mychannel.sendTransaction(orderer_request);</code></pre><h4>New organization needs to run the chaincode</h4><p>When a new organization wishes to run an existing chaincode it will have to
perform a few of the steps with the existing values.</p>
<pre class="prettyprint source"><code>// step 1:
const mychaincode = client.newChaincode('mychaincode', 'version2');
const policy_def = { ... };
mychaincode.setEndorsementPolicy(policy_def);
mychaincode.setSequence(3);

// step 3:
mychaincode.setHash(hash);

// step 4:
const tx_id = client.newTransactionID();
const request = {
   target: peer1, // this peer is in my org
   chaincode: mychaincode,
   txId: tx_id
}
const {proposalResponses, proposal} = await mychannel.defineChaincodeForOrg(request);
const orderer_request = {
   proposalResponses: proposalResponses,
   proposal, proposal
}
const results = await mychannel.sendTransaction(orderer_request);</code></pre><p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on 2019-03-27T16:33:40+00:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>